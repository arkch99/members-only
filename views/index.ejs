<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Members Only</title>
</head>
<body>
	<div class="title-bar">
		<h1>Members Only!</h1>
		<div class="user-controls">
			<% if(!user) { %> 
				<a href="/log-in">Log In</a>
				or
				<a href="/sign-up">Sign Up</a>
			<% } else {%>
				<%= user.name %>
				<a href="/log-out">Log Out</a>
				<% if(user.privilege == 0) {%> 
					<a href="/passcode">Passcode</a>
				<% } %> 
			<% } %> 
		</div>
	</div>
	<br>	
	<% if(user) { %> 
		<span id="new-message"><a href="/new-message">New message</a></span>
	<% } %> 
	<div class="content">
		<ul class="message-list">
			<% messageList.forEach(msg => { %>
				<% let time = msg.timestamp.toLocaleString(DateTime.DATETIME_FULL) %> 
				<li class="message">
					<h2 class="message-title"><%= msg.title %></h2>
					<!--show user conditionally-->
					<% if(user && msg.user._id == user.id) { %> 
						By: <a href="<%= user.url %>">You</a>,	
					<% } else if(user && user.privilege != 0){ %> 
						By: <a href="<%= msg.user.url %>"><%= msg.user.name %></a>,
					<% } else { %> 						
						By: anon,
					<% } %>
					at : <%= time %> 
					<p class="message-text">
						<%= msg.text %>
					</p>
					<% if(user && user.privilege == 2) { %> 
						<a href="<%= '/delete-message/' + msg._id %>">Delete</a>
					<% } %> 
				</li>				
			<% }); %>
		</ul>
	</div>
</body>
</html>